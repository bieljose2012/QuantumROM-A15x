name: QuantumROM Tools

on:
  workflow_dispatch:
    inputs:
      DEVICE_MODEL:
        description: "Enter the DEVICE_MODEL."
        required: true
        default: "SM-A225F"
      CSC:
        description: "Enter the CSC (Country Specific Code)"
        required: true
        default: "CSC_CODE"
      IMEI:
        description: "Enter the device IMEI number"
        required: true
        default: "123456789012345"

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout repository.
      uses: actions/checkout@v3

    - name: Installing required packages.
      run: |
        chmod +x ./scripts/install_packages.sh
        sudo bash ./scripts/install_packages.sh

    - name: Set environment variables for inputs
      run: |
        echo "DEVICE_MODEL=${{ github.event.inputs.DEVICE_MODEL }}" >> $GITHUB_ENV
        echo "CSC=${{ github.event.inputs.CSC }}" >> $GITHUB_ENV
        echo "IMEI=${{ github.event.inputs.IMEI }}" >> $GITHUB_ENV

    - name: Downloading and extracting ${{ github.event.inputs.SUPPORT_MODEL }} firmware.
      run: |
        chmod +x ./QuantumROM/Devices/${{ github.event.inputs.SUPPORT_MODEL }}/${{ github.event.inputs.SUPPORT_MODEL }}.sh
        sudo bash ./QuantumROM/Devices/${{ github.event.inputs.SUPPORT_MODEL }}/${{ github.event.inputs.SUPPORT_MODEL }}.sh

    - name: Run IMG Pack cmd
      run: |
        chmod +x ./bin/make_ext4fs
        chmod +x ./scripts/pack_ext4.sh
        bash ./scripts/pack_ext4.sh "$(pwd)/${fw_download}/${MODEL}" "$(pwd)/${BIN_DIR}" "$(pwd)/${OUT_DIR}"

    - name: Display captured inputs (for debugging)
      run: |
        echo "DEVICE_MODEL: $DEVICE_MODEL"
        echo "CSC: $CSC"
        echo "IMEI: $IMEI"
